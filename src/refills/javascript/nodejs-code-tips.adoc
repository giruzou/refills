---
rid: 1492530
bid: javascript
rcd: nodejs-code-tips
srcpath: javascript/nodejs-code-tips.adoc
title: Node.js CODE TIPS
category: JavaScript
date: 2017.4.19
layout: refill.jade
---

== ファイル読み込み

テキストファイルの読み込みである場合`'utf-8'`のようにエンコーディングを指定する。

- File System | Node.js Documentation
  * `link:https://nodejs.org/api/fs.html#fs_fs_readfilesync_path_options[fs.readFileSync(path[, options\])]`
  * `link:https://nodejs.org/api/fs.html#fs_fs_readfile_path_options_callback[fs.readFile(path[, options\], callback)]`

[source,javascript]
----
const fs = require('fs');

// sync
const text = fs.readFileSync('./input.txt', 'utf8');

// async
fs.readFile('./input.txt', 'utf8', function(err, text) {
  if (err) throw err;
  console.log(text);
});
----


== ファイル書き込み

=== ファイル書き込み（上書き）

- `link:https://nodejs.org/api/fs.html#fs_fs_writefile_file_data_options_callback[fs.writeFile(file, data[, options\], callback)]`
- `link:https://nodejs.org/api/fs.html#fs_fs_writefilesync_file_data_options[fs.writeFileSync(file, data[, options\])]`

[source,javascript]
----
require('fs').writeFile('out.txt', 'content', (e)=>{});
----

=== ファイル書き込み（追記）

- `link:https://nodejs.org/api/fs.html#fs_fs_appendfile_file_data_options_callback[fs.appendFile(file, data[, options\], callback)]`
- `link:https://nodejs.org/api/fs.html#fs_fs_appendfilesync_file_data_options[fs.appendFileSync(file, data[, options\])]`


== 1列読み込み

.sample.txt
[source]
----
red
blue
green
yellow
----

[source,javascript]
----
const fs = require('fs');
const content = fs.readFileSync('sample.txt').toString();
const colors = content.trim().split('\n');
//=> [ 'red', 'blue', 'green', 'yellow' ]
----


== CSV読み込み

.sample.csv
[source]
----
fruit
apple
#banana
orange
lemon
----

.function readCsvSync
[source,javascript]
----
function readCsvSync(filename, options) {
  const fs = require('fs');
  const parse = require('csv-parse/lib/sync');
  const content = fs.readFileSync(filename).toString();
  return parse(content, options);
}
----

.use header
[source,javascript]
----
const options = { columns: true, comment: '#' };
const records = readCsvSync('sample.csv', options);
/*
[ { fruit: 'apple' },
  { fruit: 'orange' },
  { fruit: 'lemon' } ]
*/
----

.indicate columns
[source,javascript]
----
const options = { columns: ['id'], comment: '#' };
const records = readCsvSync('sample.csv', options);
/*
[ { id: 'fruit' },
  { id: 'apple' },
  { id: 'orange' },
  { id: 'lemon' } ]
*/
----


== glob

- link:https://github.com/isaacs/node-glob[isaacs/node-glob: glob functionality for node.js]

```bash
npm i glob
```

```js
const glob = require('glob');

glob.sync("**/*.js", options, function(er, files) {
  // files is an array of filenames.
});
```


== URL Path Join

`url.resolve(from, to)` を使用する。
from で指定された URL を起点にして to という行き先を命令された場合に
結局どこに行くのかを解明した結果を返す。
from は `http://` で開始する必要はない。
逆に to が `http://` から始まる URL でもよい。
それは外部サイトに移動する時と同じ挙動と言える。

- link:https://nodejs.org/api/url.html#url_url_resolve_from_to[url.resolve(from, to) - URL | Node.js Documentation]
- link:https://stackoverflow.com/questions/16301503/can-i-use-requirepath-join-to-safely-concatenate-urls[node.js - Can I use require("path").join to safely concatenate urls? - Stack Overflow]

```js
url.resolve('/japan/tokyo/shibuya', 'ebisu')
//=> '/japan/tokyo/ebisu'
url.resolve('http://world.com', 'japan')
//=> 'http://world.com/japan'
url.resolve('http://world.com/japan/tokyo/', '/america/new-york')
//=> 'http://world.com/america/new-york'
url.resolve('http://world.com', 'https://google.com')
//=> 'https://google.com/'
```


== tktk

- link:https://www.npmjs.com/package/tktk[tktk]
