---
rid: 1494600
bid: javascript
rcd: fetch
srcpath: javascript/fetch.adoc
title: Fetch API まとめ
date: 2017/05/12
layout: refill.jade
---

== Can I use... Fetch

A modern replacement for XMLHttpRequest.

- link:http://caniuse.com/#feat=fetch[Can I use... Support tables for HTML5, CSS3, etc]

== window.fetch polyfill

- link:https://github.com/github/fetch[]

[source,bash]
----
$ npm install whatwg-fetch --save
----

=== Response

==== HTML

[source,javascript]
----
fetch('/users.html')
  .then((res) => {
    return res.text()
  }).then((body) => {
    document.body.innerHTML = body
  })
----

==== JSON

[source,javascript]
----
fetch('/users.json')
  .then((res) => {
    return res.json()
  }).then((json) => {
    console.log('success:', json)
  }).catch((ex) => {
    console.log('failed:', ex)
  })
----

==== Response metadata

[source,javascript]
----
fetch('/users.json').then((res) => {
  console.log('Content-Type', res.headers.get('Content-Type'))
  console.log('Date', res.headers.get('Date'))
  console.log('status', res.status)
  console.log('statusText', res.statusText)
})
----

== POST Form Data

[source,javascript]
----
const form = document.querySelector('form')

fetch('/users', {
  method: 'POST',
  body: new FormData(form),
})
----

[source,javascript]
----
const fd = new FormData(form)
fd.append('foo', 'bar')

fetch('/users', {
  method: 'POST',
  body: fd,
})
----

=== Cookie

[source,javascript]
----
fetch(url, {
  credentials: 'include',
})
----

=== Links

- link:https://developers.google.com/web/updates/2015/03/introduction-to-fetch[Introduction to fetch()  |  Web  |  Google Developers]
- link:http://tacamy.hatenablog.com/entry/2016/10/16/182658[jQuery.ajax()の代替としてFetch APIをざっくり使ってみる - tacamy.blog]
- link:http://stackoverflow.com/questions/34558264/fetch-api-with-cookie[Fetch API with Cookie \- Stack Overflow]
- link:https://github.com/expressjs/body-parser[expressjs/body-parser: Node.js body parsing middleware] +
  サーバサイド(express)でPOSTリクエストのボディ部を読み取るやつ
- link:https://github.com/facebook/react-native/issues/2538['unsupported BodyInit type' error is uncatchable · Issue #2538 · facebook/react-native]
